## Creating a secret manually

```text
$ kubectl create secret generic example-secret --from-literal=inner-secret=value
secret/example-secret created

$ kubectl get secrets
NAME             TYPE     DATA   AGE
example-secret   Opaque   1      11s

$ kubectl describe secret example-secret
Name:         example-secret
Namespace:    default
Labels:       <none>
Annotations:  <none>

Type:  Opaque

Data
====
inner-secret:  5 bytes

$ kubectl get secret example-secret -o jsonpath='{.data}'
{"inner-secret":"dmFsdWU="}%      
                
$ echo 'dmFsdWU=' | base64 --decode                                                                                                                                        (labs-py3.9) kurmazov@MacBook-Pro-Aleksandr labs % echo 'dmFsdWU=' | base64 --decode
value%          
```

## Creating a secret within Helm configuration

Installing the chart with a secret

```text
$ helm secrets install app-python app-python/ -n default
NAME: app-python
LAST DEPLOYED: Mon Nov 14 21:43:18 2022
NAMESPACE: default
STATUS: deployed
REVISION: 1
NOTES:
1. Get the application URL by running these commands:
     NOTE: It may take a few minutes for the LoadBalancer IP to be available.
           You can watch the status of by running 'kubectl get --namespace default svc -w app-python'
  export SERVICE_IP=$(kubectl get svc --namespace default app-python --template "{{ range (index .status.loadBalancer.ingress 0) }}{{.}}{{ end }}")
  echo http://$SERVICE_IP:80
```

Trying to get the decoded secret from pod

```text
$ kubectl get svc,pods
NAME                 TYPE           CLUSTER-IP       EXTERNAL-IP   PORT(S)        AGE
service/app-python   LoadBalancer   10.110.139.193   <pending>     80:31255/TCP   113s
service/kubernetes   ClusterIP      10.96.0.1        <none>        443/TCP        4m23s

NAME                              READY   STATUS    RESTARTS   AGE
pod/app-python-66c8584c44-v4xs8   1/1     Running   0          113s

$ kubectl exec pod/app-python-66c8584c44-v4xs8 -- printenv | grep EXAMPLE_SECRET
EXAMPLE_SECRET=value
```

## Resources management

Let's describe the current pod. Notice, that there are no memory and cpu limits

```text
...
Containers:
  app-python:
    Container ID:  docker://2677a234b2b6dd8804f9d43745cff07c949a8a557b09115d6395066a5ff20e7e
    Image:         akurmazov/server:latest
    Image ID:      docker-pullable://akurmazov/server@sha256:47c3d7fe5d17b6aa5f52b9f0e6c1b43e4723d448efbfd1e278daa318ece21d05
    Port:          8000/TCP
    Host Port:     0/TCP
    Command:
      python
      -m
      poetry
      run
      uvicorn
      server.app:app
      --host
      0.0.0.0
    State:          Running
      Started:      Mon, 14 Nov 2022 21:51:58 +0300
    Ready:          True
    Restart Count:  0
    Liveness:       http-get http://:http/health delay=0s timeout=1s period=10s #success=1 #failure=3
    Readiness:      http-get http://:http/ delay=0s timeout=1s period=10s #success=1 #failure=3
    Environment:
      EXAMPLE_SECRET:  <set to the key 'key' in secret 'example-secret'>  Optional: false
    Mounts:
      /var/run/secrets/kubernetes.io/serviceaccount from kube-api-access-fq8sq (ro)
...
```

Next, let's configure limits in the `values.yaml` file, install the chart, and describe the pods once again.
Now we can clearly see the limits that were applied.

```text
...
Containers:
  app-python:
    Container ID:  docker://c4bc9d55406d1cc0a3ec4bfd6677814213658379c67e6552b76737c9b1cdcf22
    Image:         akurmazov/server:latest
    Image ID:      docker-pullable://akurmazov/server@sha256:47c3d7fe5d17b6aa5f52b9f0e6c1b43e4723d448efbfd1e278daa318ece21d05
    Port:          8000/TCP
    Host Port:     0/TCP
    Command:
      python
      -m
      poetry
      run
      uvicorn
      server.app:app
      --host
      0.0.0.0
    State:          Running
      Started:      Mon, 14 Nov 2022 21:56:43 +0300
    Ready:          False
    Restart Count:  0
    Limits:
      cpu:     200m
      memory:  128Mi
    Requests:
      cpu:      200m
      memory:   128Mi
    Liveness:   http-get http://:http/health delay=0s timeout=1s period=10s #success=1 #failure=3
    Readiness:  http-get http://:http/ delay=0s timeout=1s period=10s #success=1 #failure=3
    Environment:
      EXAMPLE_SECRET:  <set to the key 'key' in secret 'example-secret'>  Optional: false
    Mounts:
      /var/run/secrets/kubernetes.io/serviceaccount from kube-api-access-62srk (ro)
...
```

## [Bonus] Environmental variables

I defined two environmental variables in the `values.yaml` file: DUMMY_ENV and TIMEZONE.
Next, I set up the template in the `_helpers.tpl` file for them.
Then, I exported the template into the deployment.yaml file.

Let's check the envs inside a newly installed pod:

```text
$ kubectl exec pod/app-python-6b896cc6c5-zz2qm -- printenv
PATH=/usr/local/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
HOSTNAME=app-python-6b896cc6c5-zz2qm
DUMMY_ENV=dummyEnv
EXAMPLE_SECRET=value
TIMEZONE=Europe/London
KUBERNETES_PORT_443_TCP_PORT=443
KUBERNETES_SERVICE_HOST=10.96.0.1
KUBERNETES_SERVICE_PORT=443
KUBERNETES_PORT_443_TCP_PROTO=tcp
APP_PYTHON_SERVICE_HOST=10.106.188.231
APP_PYTHON_PORT_80_TCP_PROTO=tcp
APP_PYTHON_PORT_80_TCP_PORT=80
KUBERNETES_PORT_443_TCP=tcp://10.96.0.1:443
KUBERNETES_PORT_443_TCP_ADDR=10.96.0.1
APP_PYTHON_SERVICE_PORT=80
APP_PYTHON_PORT=tcp://10.106.188.231:80
APP_PYTHON_PORT_80_TCP=tcp://10.106.188.231:80
KUBERNETES_SERVICE_PORT_HTTPS=443
KUBERNETES_PORT=tcp://10.96.0.1:443
APP_PYTHON_SERVICE_PORT_HTTP=80
APP_PYTHON_PORT_80_TCP_ADDR=10.106.188.231
LANG=C.UTF-8
GPG_KEY=E3FF2839C048B25C084DEBE9B26995E310250568
PYTHON_VERSION=3.9.4
PYTHON_PIP_VERSION=21.1.1
PYTHON_GET_PIP_URL=https://github.com/pypa/get-pip/raw/1954f15b3f102ace496a34a013ea76b061535bd2/public/get-pip.py
PYTHON_GET_PIP_SHA256=f499d76e0149a673fb8246d88e116db589afbd291739bd84f2cd9a7bca7b6993
PYTHONDONTWRITEBYTECODE=1
PYTHONUNBUFFERED=1
HOME=/home/protected_user
```

You can see that these two variables have been exported
